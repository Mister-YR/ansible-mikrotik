 hosts: mikrotik-test
  connection: network_cli
  gather_facts: true
  
  tasks:
  # first you need import module *ansible_network_os=community.routeros.routeros*
  - name: Collect all facts from the device
    community.routeros.facts:
      gather_subset: all
  # create backup with identity from facts - ansible_net_hostname    
  - name: create backup
    routeros_command:
      commands: '/system backup save name=bcp-{{ ansible_net_hostname }}'
    register: cmdout
  - debug:
       var: cmdout.stdout_lines
  # create config-backup with identity from facts - ansible_net_hostname
  - name: create cfg
    routeros_command:
      commands: '/export file=cfg-{{ ansible_net_hostname }}'
    register: cmdout
  - debug:
       var: cmdout.stdout_lines
  # copy beckup to sftp and add date to file name - ansible_date_time.date
  - name: copy config to sftp
    routeros_command:
      commands: '/tool fetch url="sftp://192.168.168.235/upload/cfg-{{ ansible_net_hostname }}-{{ ansible_date_time.date }}.rsc" src-path=cfg-{{ ansible_net_hostname }}.rsc user=USER mode=ftp password=PASS upload=yes'
    register: cmdout
  - name: copy backup to sftp
    routeros_command:
      commands: '/tool fetch url="sftp://192.168.168.235/upload/bcp-{{ ansible_net_hostname }}-{{ ansible_date_time.date }}.backup" src-path=bcp-{{ ansible_net_hostname }}.backup user=USER mode=ftp password=PASS upload=yes'
    register: cmdout
